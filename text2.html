<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MovieCove</title>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: #000;
  color: #fff;
  font-family: system-ui, sans-serif;
}

/* HEADER */
header {
  padding: 10px 14px;
  background: #000;
}
header img {
  height: 32px;
}

/* SEARCH */
.search-box {
  padding: 12px;
}
.search-box input {
  width: 100%;
  padding: 10px;
  border-radius: 6px;
  border: none;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 12px;
  padding: 12px;
}
.card {
  cursor: pointer;
}
.card img {
  width: 100%;
  border-radius: 8px;
}
.card-title {
  font-size: 13px;
  margin-top: 6px;
  text-align: center;
}

/* PLAYER */
#playerSection {
  display: none;
  padding: 12px;
}
.video-wrap {
  position: relative;
}
video {
  width: 100%;
  height: 65vh;
  background: black;
}
.watermark {
  position: absolute;
  top: 8%;
  left: 5%;
  width: 70px;
  opacity: 0.4;
  pointer-events: none;
  animation: move 25s linear infinite;
}
@keyframes move {
  0% { transform: translate(0,0); }
  25% { transform: translate(60vw,10vh); }
  50% { transform: translate(30vw,40vh); }
  75% { transform: translate(70vw,60vh); }
  100% { transform: translate(0,0); }
}

.download-btn {
  margin: 12px 0;
  padding: 12px;
  background: red;
  color: white;
  text-align: center;
  border-radius: 6px;
  text-decoration: none;
  display: none;
}

/* DETAILS */
.section {
  margin-top: 16px;
}
.section h3 {
  margin-bottom: 6px;
}
.section p {
  font-size: 14px;
  line-height: 1.4;
}

/* EPISODES */
.episodes button {
  margin: 4px;
  padding: 6px 10px;
  border-radius: 5px;
  border: none;
}

/* RECOMMEND */
.recommend {
  display: flex;
  gap: 10px;
  overflow-x: auto;
}
.recommend img {
  height: 120px;
  border-radius: 6px;
}
</style>
</head>

<body>

<header>
  <img src="assets/logo.png" alt="MovieCove">
</header>

<div class="search-box">
  <input id="search" placeholder="Search movies..." />
</div>

<div id="grid" class="grid"></div>

<!-- PLAYER -->
<div id="playerSection">
  <div class="video-wrap">
    <video id="video" controls></video>
    <img src="assets/logo.png" class="watermark">
  </div>

  <a id="download" class="download-btn">Download</a>

  <div id="summary" class="section"></div>
  <div id="cast" class="section"></div>
  <div id="episodes" class="section episodes"></div>
  <div id="recommend" class="section"></div>
</div>

<script>
const API = "https://moviecove-backend.onrender.com";
const TOKEN = "moviecove_secure_token_08166704020_tony";

const grid = document.getElementById("grid");
const playerSection = document.getElementById("playerSection");
const video = document.getElementById("video");

async function loadMovies(q="latest") {
  const res = await fetch(`${API}/movies?q=${q}`, {
    headers: { Authorization: `Bearer ${TOKEN}` }
  });
  const data = await res.json();
  grid.innerHTML = "";

  data.items.forEach(m => {
    if (!m.poster || !m.info) return;
    const c = document.createElement("div");
    c.className = "card";
    c.innerHTML = `
      <img src="${m.poster}">
      <div class="card-title">${m.title}</div>
    `;
    c.onclick = () => openMovie(m);
    grid.appendChild(c);
  });
}

async function openMovie(movie) {
  playerSection.style.display = "block";
  video.src = "";
  video.pause();

  const res = await fetch(`${API}/stream?info=${movie.info}`, {
    headers: { Authorization: `Bearer ${TOKEN}` }
  });
  const data = await res.json();
  if (!data.playable) return alert("No stream available");

  video.src = data.stream;

  const dBtn = document.getElementById("download");
  if (data.download) {
    dBtn.style.display = "block";
    dBtn.href = data.download;
  }

  // SUMMARY
  const s = document.getElementById("summary");
  s.innerHTML = movie.description ? `<h3>Summary</h3><p>${movie.description}</p>` : "";

  // CAST
  const c = document.getElementById("cast");
  c.innerHTML = movie.cast ? `<h3>Cast</h3><p>${movie.cast.join(", ")}</p>` : "";

  // EPISODES
  const e = document.getElementById("episodes");
  e.innerHTML = "";
  if (movie.seasons) {
    e.innerHTML = "<h3>Episodes</h3>";
    movie.seasons.forEach(season => {
      season.episodes.forEach(ep => {
        const b = document.createElement("button");
        b.textContent = `S${season.season}E${ep.episode}`;
        b.onclick = () => openEpisode(movie.info, season.season, ep.episode);
        e.appendChild(b);
      });
    });
  }

  // RECOMMEND
  const r = document.getElementById("recommend");
  r.innerHTML = "<h3>Recommended</h3><div class='recommend'></div>";
  loadMovies(movie.title.split(" ")[0]);
}

async function openEpisode(info, s, e) {
  const res = await fetch(`${API}/stream?info=${info}&season=${s}&episode=${e}`, {
    headers: { Authorization: `Bearer ${TOKEN}` }
  });
  const data = await res.json();
  video.src = data.stream;
}

document.getElementById("search").oninput = e => loadMovies(e.target.value);

loadMovies();
</script>
</body>
    </html>
